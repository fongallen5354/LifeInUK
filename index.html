<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MC Revision Quiz</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 720px; margin: 32px auto; padding: 0 16px; }
  #score { font-weight: bold; margin-bottom: 12px; }
  #question { margin: 6px 0 12px; }
  .option { padding: 10px 12px; border: 1px solid #ccc; border-radius: 8px; margin: 8px 0; cursor: pointer; white-space: pre-wrap; }
  .option:hover { border-color: #999; }
  .correct { background-color: #c8e6c9; }
  .wrong { background-color: #ffcdd2; }
  button { padding: 10px 16px; margin-top: 12px; border-radius: 10px; border: 1px solid #bbb; background: #fff; cursor: pointer; }
  button:disabled { opacity: 0.6; cursor: not-allowed; }
  .hidden { display: none; }
</style>
</head>
<body>
  <div id="score">Score: 0/0</div>
  <h2 id="question"></h2>
  <div id="options"></div>
  <button id="checkBtn">Check</button>
  <button id="nextBtn" class="hidden">Next</button>

  <div id="result" class="hidden" style="margin-top:18px; font-size:18px; font-weight:600;"></div>
  <button id="tryAgainBtn" class="hidden">Try Again</button>

<script>
/* ---- Robust CSV parser (handles quotes, commas, CRLF) ---- */
function parseCSV(text) {
  const rows = [];
  let row = [], cur = '', inQuotes = false;

  for (let i = 0; i < text.length; i++) {
    const c = text[i];

    if (inQuotes) {
      if (c === '"') {
        if (text[i + 1] === '"') { // escaped quote
          cur += '"';
          i++;
        } else {
          inQuotes = false;
        }
      } else {
        cur += c;
      }
    } else {
      if (c === '"') {
        inQuotes = true;
      } else if (c === ',') {
        row.push(cur);
        cur = '';
      } else if (c === '\n') {
        row.push(cur);
        rows.push(row);
        row = [];
        cur = '';
      } else if (c === '\r') {
        // ignore CR (handle CRLF)
      } else {
        cur += c;
      }
    }
  }
  // last cell / last row
  if (cur.length > 0 || row.length > 0) {
    row.push(cur);
    rows.push(row);
  }
  return rows;
}

/* ---- Load and normalize CSV according to headers ---- */
async function loadCSV(url) {
  const res = await fetch(url);
  const text = await res.text();

  // Remove BOM if present
  const clean = text.replace(/^\uFEFF/, '').trim();
  const raw = parseCSV(clean);

  if (raw.length === 0) return [];

  const header = raw.shift().map(h => h.trim().toLowerCase());
  const idx = {
    question: header.indexOf('question'),
    a: header.indexOf('option a'),
    b: header.indexOf('option b'),
    c: header.indexOf('option c'),
    d: header.indexOf('option d'),
    correct: header.indexOf('correct answer')
  };

  const data = [];
  for (const r of raw) {
    const q = (r[idx.question] || '').trim();
    if (!q) continue;

    // Collect wrong options (support A–D; any missing ones are skipped)
    const wrongs = [];
    ['a','b','c','d'].forEach(k => {
      const pos = idx[k];
      if (pos !== -1 && r[pos] != null && String(r[pos]).trim() !== '') {
        wrongs.push(String(r[pos]).trim());
      }
    });

    const correct = idx.correct !== -1 ? String(r[idx.correct] || '').trim() : '';
    if (!correct) continue;

    data.push({ question: q, wrong: wrongs, correct });
  }
  return data;
}

/* ---- Fisher–Yates shuffle ---- */
function shuffle(arr) {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

/* ---- Quiz state ---- */
let quizSet = [];
let currentQ = 0;
let selectedOption = null;
let score = 0;
let total = 0;

const scoreEl   = document.getElementById('score');
const qEl       = document.getElementById('question');
const optsEl    = document.getElementById('options');
const checkBtn  = document.getElementById('checkBtn');
const nextBtn   = document.getElementById('nextBtn');
const resultEl  = document.getElementById('result');
const againBtn  = document.getElementById('tryAgainBtn');

function updateScore() {
  scoreEl.textContent = `Score: ${score}/${total}`;
}

function renderQuestion(index) {
  const q = quizSet[index];
  updateScore();
  qEl.textContent = `Q${index + 1}: ${q.question}`;

  optsEl.innerHTML = '';
  selectedOption = null;

  q.options.forEach(opt => {
    const div = document.createElement('div');
    div.className = 'option';
    div.textContent = opt.text;   // t
