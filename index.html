<!DOCTYPE html>
<html>
<head>
  <title>Revision Quiz</title>
  <style>
    body {
      font-family: sans-serif;
      line-height: 1.6;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    .question-container {
      margin-bottom: 20px;
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 5px;
    }
    .options label {
      display: block;
      margin-bottom: 10px;
    }
    .check-button {
      padding: 5px 10px;
      margin-top: 10px;
      cursor: pointer;
    }
    .submit-all-button {
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
    }
    #results {
      margin-top: 20px;
      font-weight: bold;
    }
    .correct-answer {
      color: green;
      font-weight: bold;
    }
    .incorrect-answer {
      color: red;
      font-weight: bold;
    }
    .correct-feedback {
      background-color: #d4edda; /* Light green */
    }
    .incorrect-feedback {
      background-color: #f8d7da; /* Light red */
    }
  </style>
</head>
<body>

  <h1>Revision Quiz</h1>

  <div id="quiz-container"></div>

  <button id="submit-all-button" class="submit-all-button">Submit All Answers</button>

  <div id="results"></div>

  <script>
    const quizContainer = document.getElementById('quiz-container');
    const submitAllButton = document.getElementById('submit-all-button');
    const resultsContainer = document.getElementById('results');

    let questions = [];

    async function loadQuiz() {
      try {
        const response = await fetch('questions.csv');
        const text = await response.text();
        const lines = text.split('\n').filter(line => line.trim() !== '');
        questions = lines.slice(1).map(line => {
          const [question, optionA, optionB, optionC, optionD, correctAnswer] = line.split(',');
          return {
            question: question.replace(/"/g, ''),
            options: [optionA.replace(/"/g, ''), optionB.replace(/"/g, ''), optionC.replace(/"/g, ''), optionD.replace(/"/g, '')],
            correctAnswer: correctAnswer.replace(/"/g, '')
          };
        });

        displayQuestions();
        submitAllButton.addEventListener('click', showTotalResults);

      } catch (error) {
        resultsContainer.innerHTML = 'Error loading the quiz: ' + error;
      }
    }

    function displayQuestions() {
      questions.forEach((q, index) => {
        const questionElement = document.createElement('div');
        questionElement.classList.add('question-container');
        questionElement.dataset.questionIndex = index;
        questionElement.innerHTML = `
          <p><b>${q.question}</b></p>
          <div class="options">
            ${q.options.map((option, i) => `
              <label>
                <input type="radio" name="question${index}" value="${option}">
                ${option}
              </label>
            `).join('')}
          </div>
          <button class="check-button" onclick="checkSingleAnswer(${index})">Check Answer</button>
          <div class="feedback-message" id="feedback-message-${index}"></div>
        `;
        quizContainer.appendChild(questionElement);
      });
    }
    
    function checkSingleAnswer(questionIndex) {
      const question = questions[questionIndex];
      const selectedOption = document.querySelector(`input[name="question${questionIndex}"]:checked`);
      const feedbackMessage = document.getElementById(`feedback-message-${questionIndex}`);
      const questionContainer = document.querySelector(`.question-container[data-question-index="${questionIndex}"]`);

      if (!selectedOption) {
        feedbackMessage.innerHTML = 'Please select an answer.';
        feedbackMessage.className = 'feedback-message incorrect-answer';
        return;
      }
      
      const isCorrect = (selectedOption.value.trim() === question.correctAnswer.trim());
      
      // Clear previous feedback classes
      questionContainer.classList.remove('correct-feedback', 'incorrect-feedback');
      
      if (isCorrect) {
        feedbackMessage.innerHTML = 'Correct!';
        feedbackMessage.className = 'feedback-message correct-answer';
        questionContainer.classList.add('correct-feedback');
      } else {
        feedbackMessage.innerHTML = 'Incorrect. The correct answer is: ' + question.correctAnswer;
        feedbackMessage.className = 'feedback-message incorrect-answer';
        questionContainer.classList.add('incorrect-feedback');
      }
      
      // Disable options and check button after checking
      document.querySelectorAll(`input[name="question${questionIndex}"]`).forEach(input => {
          input.disabled = true;
      });
      document.querySelector(`.question-container[data-question-index="${questionIndex}"] .check-button`).disabled = true;
    }

    function showTotalResults() {
      let score = 0;
      let incorrectAnswers = [];

      questions.forEach((q, index) => {
        const selectedOption = document.querySelector(`input[name="question${index}"]:checked`);
        const questionContainer = document.querySelector(`.question-container[data-question-index="${index}"]`);
        
        if (selectedOption && selectedOption.value.trim() === q.correctAnswer.trim()) {
          score++;
        }
      });
      
      resultsContainer.innerHTML = `<h2>Your Total Score: ${score} out of ${questions.length}</h2>`;
    }

    loadQuiz();
  </script>

</body>
</html>
